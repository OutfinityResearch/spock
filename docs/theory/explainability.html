<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Native Explainability ‚Äì Spock AGISystem2</title>
  <link rel="stylesheet" href="../reference/style.css">
  <style>
    .diagram-container {
      background: #fafafa;
      padding: 30px;
      border-radius: 12px;
      margin: 25px 0;
      text-align: center;
    }
    .principle-box {
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      border-left: 5px solid #4caf50;
      padding: 30px;
      margin: 30px 0;
      border-radius: 0 12px 12px 0;
      font-size: 1.2em;
      text-align: center;
    }
    .code-block {
      background: #263238;
      color: #e0e0e0;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Consolas', monospace;
      margin: 15px 0;
      overflow-x: auto;
    }
    .code-block .dsl { color: #aed581; }
    .code-block .comment { color: #78909c; }
    .code-block .keyword { color: #80cbc4; }
    .code-block .output { color: #ffcc80; }
    .comparison-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 25px 0;
    }
    .compare-card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .compare-card.bad {
      border-top: 4px solid #e53935;
    }
    .compare-card.good {
      border-top: 4px solid #4caf50;
    }
    .compare-card h4 {
      margin-top: 0;
    }
    .trace-step {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      margin: 10px 0;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    .trace-step .num {
      background: #1976d2;
      color: white;
      min-width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    .trace-step .content {
      flex-grow: 1;
    }
    .trace-step .dsl {
      font-family: monospace;
      background: #f5f5f5;
      padding: 5px 10px;
      border-radius: 4px;
      margin-bottom: 5px;
    }
    .trace-step .explain {
      font-size: 0.9em;
      color: #666;
    }
    .output-format {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
      margin: 20px 0;
    }
    .output-format .header {
      background: #1976d2;
      color: white;
      padding: 10px 15px;
      font-weight: bold;
    }
    .output-format .body {
      padding: 15px;
    }
  </style>
</head>
<body>
  <div class="page">
  <div class="nav-header">
    <h1>Native Explainability</h1>
    <small>
      <a href="../index.html">Home</a> ¬∑
      <a href="index.html">Theory</a> ¬∑
      <a href="theory-spaces.html">Theories</a> ¬∑
      <a href="explainability.html">Explainability</a>
    </small>
    <small>Every computation is traceable, replayable, and auditable</small>
  </div>

  <div class="principle-box">
    <strong>The DSL-In/DSL-Out Principle:</strong><br>
    Everything that enters Spock is a DSL script.<br>
    Everything that exits Spock is a DSL script.<br>
    <em>No black boxes. Full transparency.</em>
  </div>

  <h2>The Explainability Problem</h2>

  <div class="comparison-grid">
    <div class="compare-card bad">
      <h4>‚ùå Neural Networks</h4>
      <p><strong>Input:</strong> "Is Socrates mortal?"</p>
      <p><strong>Output:</strong> "Yes (0.94 confidence)"</p>
      <p><strong>Explanation:</strong> "I processed your query through 175 billion parameters across 96 transformer layers with attention heads that... <em>[incomprehensible]</em>"</p>
    </div>
    <div class="compare-card good">
      <h4>‚úì Spock AGISystem2</h4>
      <p><strong>Input:</strong> DSL script</p>
      <p><strong>Output:</strong> DSL trace + score</p>
      <p><strong>Explanation:</strong> "Here's every step I took, as executable code you can verify."</p>
    </div>
  </div>

  <h2>The Dual Output Strategy</h2>

  <p>Every Spock API call returns two outputs:</p>

  <div class="diagram-container">
    <svg width="650" height="280" viewBox="0 0 650 280">
      <text x="325" y="25" text-anchor="middle" font-size="16" font-weight="bold" fill="#1976d2">Dual Output Architecture (FS-07)</text>

      <!-- Input -->
      <g transform="translate(80, 130)">
        <rect x="-60" y="-40" width="120" height="80" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="8"/>
        <text x="0" y="-15" text-anchor="middle" font-size="12" font-weight="bold" fill="#333">DSL Input</text>
        <text x="0" y="5" text-anchor="middle" font-size="10" fill="#666">@fact Socrates Is Human</text>
        <text x="0" y="20" text-anchor="middle" font-size="10" fill="#666">@query fact Evaluate Truth</text>
      </g>

      <!-- Arrow to processor -->
      <line x1="150" y1="130" x2="220" y2="130" stroke="#333" stroke-width="2" marker-end="url(#procArrow)"/>

      <!-- Processor -->
      <g transform="translate(300, 130)">
        <rect x="-70" y="-50" width="140" height="100" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="8"/>
        <text x="0" y="-25" text-anchor="middle" font-size="12" font-weight="bold" fill="#333">Spock Engine</text>
        <text x="0" y="-5" text-anchor="middle" font-size="9" fill="#666">Parse ‚Üí Execute</text>
        <text x="0" y="10" text-anchor="middle" font-size="9" fill="#666">‚Üí Trace ‚Üí Score</text>
        <text x="0" y="30" text-anchor="middle" font-size="9" fill="#666">‚Üí Format Output</text>
      </g>

      <!-- Arrows to outputs -->
      <line x1="380" y1="100" x2="450" y2="70" stroke="#333" stroke-width="2" marker-end="url(#procArrow)"/>
      <line x1="380" y1="160" x2="450" y2="190" stroke="#333" stroke-width="2" marker-end="url(#procArrow)"/>

      <!-- Result Theory output -->
      <g transform="translate(540, 60)">
        <rect x="-80" y="-35" width="160" height="70" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="8"/>
        <text x="0" y="-15" text-anchor="middle" font-size="11" font-weight="bold" fill="#4caf50">resultTheory</text>
        <text x="0" y="5" text-anchor="middle" font-size="9" fill="#666">Clean conclusion</text>
        <text x="0" y="20" text-anchor="middle" font-size="9" fill="#666">For production use</text>
      </g>

      <!-- Execution Trace output -->
      <g transform="translate(540, 200)">
        <rect x="-80" y="-35" width="160" height="70" fill="#fff8e1" stroke="#ffc107" stroke-width="2" rx="8"/>
        <text x="0" y="-15" text-anchor="middle" font-size="11" font-weight="bold" fill="#f57c00">executionTrace</text>
        <text x="0" y="5" text-anchor="middle" font-size="9" fill="#666">Complete step log</text>
        <text x="0" y="20" text-anchor="middle" font-size="9" fill="#666">For debug/eval</text>
      </g>

      <defs>
        <marker id="procArrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
          <polygon points="0 0, 8 3, 0 6" fill="#333"/>
        </marker>
      </defs>
    </svg>
  </div>

  <h2>Output Format</h2>

  <div class="output-format">
    <div class="header">resultTheory (Production Output)</div>
    <div class="body">
      <div class="code-block">
<span class="dsl">@conclusion Query HasTruth 0.92</span>
<span class="comment"># Clean, minimal, actionable</span>
      </div>
    </div>
  </div>

  <div class="output-format">
    <div class="header">executionTrace (Debug Output)</div>
    <div class="body">
      <div class="code-block">
<span class="comment"># Full execution trace - replayable!</span>
<span class="dsl">@step1 Socrates Identity _</span>            <span class="comment"># Create Socrates vector</span>
<span class="dsl">@step2 Human Identity _</span>               <span class="comment"># Create Human vector</span>
<span class="dsl">@step3 step1 Bind Is</span>                  <span class="comment"># Bind with Is relation</span>
<span class="dsl">@step4 step3 Add step2</span>                <span class="comment"># Add Human concept</span>
<span class="dsl">@fact step4 Normalise _</span>               <span class="comment"># Normalize result</span>
<span class="dsl">@eval fact Distance Truth</span>             <span class="comment"># Project onto Truth</span>
<span class="dsl">@result eval Persist _</span>                <span class="comment"># ‚Üí 0.92</span>
      </div>
    </div>
  </div>

  <h2>Trace Anatomy</h2>

  <p>Each step in the trace records:</p>

  <div class="trace-step">
    <div class="num">1</div>
    <div class="content">
      <div class="dsl">@step1 Socrates Bind Human</div>
      <div class="explain">
        <strong>Inputs:</strong> Socrates (vector), Human (vector)<br>
        <strong>Verb:</strong> Bind (Hadamard product)<br>
        <strong>Output:</strong> @step1 (new vector)<br>
        <strong>Effect:</strong> Creates "Socrates-Human" relationship
      </div>
    </div>
  </div>

  <div class="trace-step">
    <div class="num">2</div>
    <div class="content">
      <div class="dsl">@step2 step1 Move Mortal</div>
      <div class="explain">
        <strong>Inputs:</strong> @step1 (from previous), Mortal (vector)<br>
        <strong>Verb:</strong> Move (vector addition)<br>
        <strong>Output:</strong> @step2 (new vector)<br>
        <strong>Effect:</strong> Transitions toward mortality concept
      </div>
    </div>
  </div>

  <div class="trace-step">
    <div class="num">3</div>
    <div class="content">
      <div class="dsl">@result step2 Evaluate Truth</div>
      <div class="explain">
        <strong>Inputs:</strong> @step2 (previous result), Truth (canonical)<br>
        <strong>Verb:</strong> Evaluate (cosine projection)<br>
        <strong>Output:</strong> 0.89 (scalar)<br>
        <strong>Effect:</strong> Measures truth alignment
      </div>
    </div>
  </div>

  <h2>Replayability</h2>

  <p>Any execution trace can be <strong>replayed</strong> to verify results:</p>

  <div class="diagram-container">
    <svg width="550" height="180" viewBox="0 0 550 180">
      <text x="275" y="25" text-anchor="middle" font-size="14" font-weight="bold" fill="#1976d2">Trace Replay Verification</text>

      <!-- Original run -->
      <g transform="translate(100, 90)">
        <rect x="-70" y="-30" width="140" height="60" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
        <text x="0" y="-5" text-anchor="middle" font-size="11" font-weight="bold" fill="#333">Original Run</text>
        <text x="0" y="15" text-anchor="middle" font-size="10" fill="#666">Score: 0.89</text>
      </g>

      <!-- Arrow -->
      <line x1="180" y1="90" x2="230" y2="90" stroke="#333" stroke-width="2"/>
      <text x="205" y="80" text-anchor="middle" font-size="10" fill="#666">export trace</text>

      <!-- Trace file -->
      <g transform="translate(280, 90)">
        <rect x="-40" y="-30" width="80" height="60" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="5"/>
        <text x="0" y="0" text-anchor="middle" font-size="10" fill="#333">trace.dsl</text>
        <text x="0" y="15" text-anchor="middle" font-size="24" fill="#ff9800">üìÑ</text>
      </g>

      <!-- Arrow -->
      <line x1="330" y1="90" x2="380" y2="90" stroke="#333" stroke-width="2"/>
      <text x="355" y="80" text-anchor="middle" font-size="10" fill="#666">replay</text>

      <!-- Replay run -->
      <g transform="translate(450, 90)">
        <rect x="-70" y="-30" width="140" height="60" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5"/>
        <text x="0" y="-5" text-anchor="middle" font-size="11" font-weight="bold" fill="#333">Replayed Run</text>
        <text x="0" y="15" text-anchor="middle" font-size="10" fill="#4caf50">Score: 0.89 ‚úì</text>
      </g>

      <text x="275" y="160" text-anchor="middle" font-size="11" fill="#666">Same seed + same trace = identical results</text>
    </svg>
  </div>

  <h2>Determinism Guarantees</h2>

  <p>For full reproducibility, Spock supports seeded random generation:</p>

  <div class="code-block">
<span class="keyword">const</span> engine = createSpockEngine({
  dimensions: 512,
  seed: 42  <span class="comment">// Deterministic vector generation</span>
});

<span class="comment">// With same seed, "Cat" always produces the same vector</span>
<span class="comment">// Traces are perfectly reproducible</span>
  </div>

  <table class="matrix-table">
    <tr>
      <th>Component</th>
      <th>Deterministic?</th>
      <th>How</th>
    </tr>
    <tr>
      <td>Vector generation</td>
      <td>‚úì Yes (with seed)</td>
      <td>Mulberry32 PRNG with configurable seed</td>
    </tr>
    <tr>
      <td>Symbol resolution</td>
      <td>‚úì Yes</td>
      <td>Fixed LIFO order through overlays</td>
    </tr>
    <tr>
      <td>Execution order</td>
      <td>‚úì Yes</td>
      <td>Topological sort of dependency graph</td>
    </tr>
    <tr>
      <td>Kernel operations</td>
      <td>‚úì Yes</td>
      <td>Pure functions on Float32Arrays</td>
    </tr>
    <tr>
      <td>Planning</td>
      <td>‚úì Yes (mostly)</td>
      <td>Greedy selection; random_restart adds non-determinism</td>
    </tr>
  </table>

  <h2>Evaluation Framework</h2>

  <p>The dual output enables automated evaluation:</p>

  <div class="diagram-container">
    <svg width="600" height="220" viewBox="0 0 600 220">
      <text x="300" y="25" text-anchor="middle" font-size="14" font-weight="bold" fill="#1976d2">Automated Evaluation Pipeline</text>

      <!-- Test case -->
      <g transform="translate(80, 100)">
        <rect x="-60" y="-40" width="120" height="80" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
        <text x="0" y="-15" text-anchor="middle" font-size="10" font-weight="bold" fill="#333">Test Case</text>
        <text x="0" y="5" text-anchor="middle" font-size="9" fill="#666">input.dsl</text>
        <text x="0" y="20" text-anchor="middle" font-size="9" fill="#666">expected.dsl</text>
      </g>

      <!-- Arrow -->
      <line x1="150" y1="100" x2="200" y2="100" stroke="#333" stroke-width="2" marker-end="url(#evalArrow)"/>

      <!-- Engine -->
      <g transform="translate(270, 100)">
        <rect x="-60" y="-40" width="120" height="80" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="5"/>
        <text x="0" y="-10" text-anchor="middle" font-size="10" font-weight="bold" fill="#333">Spock Engine</text>
        <text x="0" y="10" text-anchor="middle" font-size="9" fill="#666">Run with seed</text>
        <text x="0" y="25" text-anchor="middle" font-size="9" fill="#666">‚Üí resultTheory</text>
      </g>

      <!-- Arrow -->
      <line x1="340" y1="100" x2="390" y2="100" stroke="#333" stroke-width="2" marker-end="url(#evalArrow)"/>

      <!-- Comparator -->
      <g transform="translate(460, 100)">
        <rect x="-60" y="-40" width="120" height="80" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5"/>
        <text x="0" y="-15" text-anchor="middle" font-size="10" font-weight="bold" fill="#333">Compare</text>
        <text x="0" y="5" text-anchor="middle" font-size="9" fill="#666">actual vs expected</text>
        <text x="0" y="25" text-anchor="middle" font-size="11" fill="#4caf50">‚úì PASS / ‚úó FAIL</text>
      </g>

      <defs>
        <marker id="evalArrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
          <polygon points="0 0, 8 3, 0 6" fill="#333"/>
        </marker>
      </defs>

      <text x="300" y="190" text-anchor="middle" font-size="10" fill="#666">
        DSL output comparison enables exact regression testing
      </text>
    </svg>
  </div>

  <h2>API Response Structure</h2>

  <div class="code-block">
{
  <span class="keyword">success</span>: true,
  <span class="keyword">score</span>: 0.89,                    <span class="comment">// Quick numeric indicator</span>
  <span class="keyword">resultTheory</span>: <span class="output">"@conclusion Query HasTruth 0.89"</span>,
  <span class="keyword">executionTrace</span>: <span class="output">"@step1 ... @step2 ... @result ..."</span>,

  <span class="comment">// Legacy/debug fields</span>
  <span class="keyword">symbols</span>: Map { ... },           <span class="comment">// All computed symbols</span>
  <span class="keyword">scores</span>: { truth: 0.89, confidence: 0.78 },
  <span class="keyword">trace</span>: { ... }                  <span class="comment">// Structured trace object</span>
}
  </div>

  <h2>Why This Matters</h2>

  <div class="principle-box" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-color: #1976d2;">
    <strong>Spock AGISystem2 is fully auditable because:</strong>
    <ul style="text-align: left; max-width: 500px; margin: 15px auto;">
      <li>Every input is a parseable DSL script</li>
      <li>Every output is a parseable DSL script</li>
      <li>Every step is logged with inputs, verb, and output</li>
      <li>Traces can be replayed for verification</li>
      <li>Deterministic seeds enable exact reproduction</li>
      <li>No hidden state, no opaque transformations</li>
    </ul>
  </div>

  <h2>For Researchers</h2>

  <p>This architecture enables:</p>

  <table class="matrix-table">
    <tr>
      <th>Research Activity</th>
      <th>How Spock Helps</th>
    </tr>
    <tr>
      <td>Debugging reasoning</td>
      <td>Step through trace, see exactly where it went wrong</td>
    </tr>
    <tr>
      <td>Regression testing</td>
      <td>Compare DSL outputs across versions</td>
    </tr>
    <tr>
      <td>Ablation studies</td>
      <td>Remove/modify steps in trace, replay, measure impact</td>
    </tr>
    <tr>
      <td>Hybrid systems</td>
      <td>LLM generates DSL, Spock executes with full trace</td>
    </tr>
    <tr>
      <td>Formal verification</td>
      <td>DSL can be analyzed statically for properties</td>
    </tr>
  </table>

  <div class="footer-nav">
    <p>
      <a href="theory-spaces.html">‚Üê Theories as Subspaces</a> ¬∑
      <a href="index.html">Back to Theory Index ‚Üí</a>
    </p>
  </div>
  </div>
</body>
</html>
