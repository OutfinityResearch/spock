<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Semantic Gradient Descent – Spock AGISystem2</title>
  <link rel="stylesheet" href="../reference/style.css">
  <style>
    .diagram-container {
      background: #fafafa;
      padding: 30px;
      border-radius: 12px;
      margin: 25px 0;
      text-align: center;
    }
    .algorithm-box {
      background: #263238;
      color: #e0e0e0;
      padding: 25px;
      border-radius: 8px;
      font-family: 'Consolas', monospace;
      margin: 20px 0;
      overflow-x: auto;
    }
    .algorithm-box .keyword {
      color: #80cbc4;
    }
    .algorithm-box .comment {
      color: #78909c;
    }
    .algorithm-box .function {
      color: #aed581;
    }
    .key-insight {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      border-left: 4px solid #1976d2;
      padding: 25px;
      margin: 25px 0;
      border-radius: 0 12px 12px 0;
    }
    .strategy-card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 15px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-left: 4px solid #1976d2;
    }
    .strategy-card h4 {
      margin-top: 0;
      color: #1976d2;
    }
    .step-indicator {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 8px;
    }
    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    .step .num {
      background: #1976d2;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    .step .label {
      font-size: 0.9em;
      color: #666;
    }
    .connector {
      flex-grow: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .connector::after {
      content: '→';
      color: #999;
      font-size: 1.5em;
    }
  </style>
</head>
<body>
  <div class="page">
  <div class="nav-header">
    <h1>Semantic Gradient Descent</h1>
    <small>
      <a href="../index.html">Home</a> ·
      <a href="index.html">Theory</a> ·
      <a href="vsa-operations.html">Operations</a> ·
      <a href="semantic-navigation.html">Navigation</a> ·
      <a href="theory-spaces.html">Theories</a>
    </small>
    <small>Reasoning as navigation through conceptual space</small>
  </div>

  <div class="key-insight">
    <strong>The Core Metaphor:</strong> Instead of searching for logical proofs, Spock AGISystem2 <em>navigates</em> through conceptual space. Reasoning becomes finding a path from where you are to where you want to be.
  </div>

  <h2>The Navigation Paradigm</h2>

  <p>Traditional reasoning asks: "Can I prove X from Y using rules?" Spock asks: "How do I get from Y to X?"</p>

  <div class="diagram-container">
    <svg width="700" height="350" viewBox="0 0 700 350">
      <text x="350" y="25" text-anchor="middle" font-size="18" font-weight="bold" fill="#1976d2">Reasoning as Navigation</text>

      <!-- Conceptual space background -->
      <rect x="50" y="50" width="600" height="250" fill="#fafafa" stroke="#e0e0e0" rx="10"/>
      <text x="350" y="75" text-anchor="middle" font-size="12" fill="#999">Conceptual Space</text>

      <!-- Start point -->
      <circle cx="120" cy="200" r="20" fill="#1976d2"/>
      <text x="120" y="205" text-anchor="middle" font-size="12" font-weight="bold" fill="white">S</text>
      <text x="120" y="240" text-anchor="middle" font-size="11" fill="#1976d2">Start State</text>

      <!-- Goal point -->
      <circle cx="580" cy="130" r="25" fill="#4caf50"/>
      <text x="580" y="135" text-anchor="middle" font-size="12" font-weight="bold" fill="white">G</text>
      <text x="580" y="170" text-anchor="middle" font-size="11" fill="#4caf50">Goal State</text>

      <!-- Path with waypoints -->
      <path d="M 140,195 Q 200,180 250,160 T 350,140 T 450,125 T 555,130"
            fill="none" stroke="#ff9800" stroke-width="3" stroke-dasharray="8,4"/>

      <!-- Waypoints -->
      <circle cx="250" cy="160" r="8" fill="#ff9800"/>
      <circle cx="350" cy="140" r="8" fill="#ff9800"/>
      <circle cx="450" cy="125" r="8" fill="#ff9800"/>

      <!-- Action labels -->
      <text x="190" y="155" font-size="10" fill="#ff9800">Action₁</text>
      <text x="295" y="135" font-size="10" fill="#ff9800">Action₂</text>
      <text x="395" y="115" font-size="10" fill="#ff9800">Action₃</text>
      <text x="500" y="115" font-size="10" fill="#ff9800">Action₄</text>

      <!-- Gradient arrow (direction to goal) -->
      <defs>
        <marker id="gradArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#9c27b0"/>
        </marker>
      </defs>

      <line x1="250" y1="160" x2="320" y2="145" stroke="#9c27b0" stroke-width="2" marker-end="url(#gradArrow)"/>
      <text x="280" y="175" font-size="9" fill="#9c27b0">gradient</text>

      <!-- Legend -->
      <g transform="translate(550, 230)">
        <rect x="0" y="0" width="100" height="60" fill="white" stroke="#ddd" rx="4"/>
        <circle cx="15" cy="15" r="6" fill="#ff9800"/>
        <text x="30" y="19" font-size="10" fill="#333">Waypoint</text>
        <line x1="10" y1="35" x2="40" y2="35" stroke="#9c27b0" stroke-width="2"/>
        <text x="50" y="39" font-size="10" fill="#333">Gradient</text>
      </g>
    </svg>
  </div>

  <h2>The Algorithm</h2>

  <div class="step-indicator">
    <div class="step">
      <div class="num">1</div>
      <div class="label">Compute Gradient</div>
    </div>
    <div class="connector"></div>
    <div class="step">
      <div class="num">2</div>
      <div class="label">Generate Actions</div>
    </div>
    <div class="connector"></div>
    <div class="step">
      <div class="num">3</div>
      <div class="label">Select Best</div>
    </div>
    <div class="connector"></div>
    <div class="step">
      <div class="num">4</div>
      <div class="label">Apply & Record</div>
    </div>
    <div class="connector"></div>
    <div class="step">
      <div class="num">5</div>
      <div class="label">Check Goal</div>
    </div>
  </div>

  <div class="algorithm-box">
<span class="keyword">function</span> <span class="function">plan</span>(initial, goal, actions, options) {
    <span class="keyword">let</span> current = initial;
    <span class="keyword">let</span> steps = [];

    <span class="keyword">while</span> (!isGoalReached(current, goal, options.epsilon)) {
        <span class="comment">// 1. Compute gradient: direction toward goal</span>
        <span class="keyword">let</span> gradient = <span class="function">normalise</span>(goal - current);

        <span class="comment">// 2. Find best action (most aligned with gradient)</span>
        <span class="keyword">let</span> best = null;
        <span class="keyword">let</span> bestScore = -Infinity;

        <span class="keyword">for</span> (action <span class="keyword">of</span> actions) {
            <span class="keyword">let</span> next = <span class="function">apply</span>(action, current);
            <span class="keyword">let</span> score = <span class="function">cosineSimilarity</span>(next, goal);

            <span class="keyword">if</span> (score > bestScore) {
                bestScore = score;
                best = { action, next, score };
            }
        }

        <span class="comment">// 3. Handle plateau (no improvement)</span>
        <span class="keyword">if</span> (best.score <= <span class="function">cosineSimilarity</span>(current, goal)) {
            <span class="keyword">return</span> <span class="function">handlePlateau</span>(current, goal, steps, options);
        }

        <span class="comment">// 4. Apply action and record step</span>
        current = best.next;
        steps.push({ action: best.action, state: current });

        <span class="comment">// 5. Safety check</span>
        <span class="keyword">if</span> (steps.length >= options.maxSteps) <span class="keyword">break</span>;
    }

    <span class="keyword">return</span> { success: true, steps, finalState: current };
}
  </div>

  <h2>Gradient Computation</h2>

  <div class="diagram-container">
    <svg width="500" height="250" viewBox="0 0 500 250">
      <text x="250" y="25" text-anchor="middle" font-size="16" font-weight="bold" fill="#1976d2">Computing the Gradient</text>

      <g transform="translate(250, 140)">
        <!-- Axes -->
        <line x1="-180" y1="0" x2="180" y2="0" stroke="#ddd" stroke-width="1"/>
        <line x1="0" y1="80" x2="0" y2="-80" stroke="#ddd" stroke-width="1"/>

        <!-- Current position -->
        <circle cx="-80" cy="40" r="12" fill="#1976d2"/>
        <text x="-80" y="44" text-anchor="middle" font-size="10" fill="white">C</text>
        <text x="-80" y="70" text-anchor="middle" font-size="10" fill="#1976d2">Current</text>

        <!-- Goal position -->
        <circle cx="100" cy="-50" r="15" fill="#4caf50"/>
        <text x="100" y="-46" text-anchor="middle" font-size="10" fill="white">G</text>
        <text x="100" y="-75" text-anchor="middle" font-size="10" fill="#4caf50">Goal</text>

        <!-- Gradient vector (from C toward G) -->
        <defs>
          <marker id="gradientArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#ff9800"/>
          </marker>
        </defs>

        <line x1="-80" y1="40" x2="30" y2="-15" stroke="#ff9800" stroke-width="3" marker-end="url(#gradientArrow)"/>
        <text x="-25" y="5" font-size="11" fill="#ff9800">gradient = norm(G - C)</text>

        <!-- Formula box -->
        <g transform="translate(0, 95)">
          <rect x="-120" y="-15" width="240" height="30" fill="white" stroke="#ddd" rx="4"/>
          <text x="0" y="5" text-anchor="middle" font-size="11" fill="#333">
            gradient points in the direction of maximum improvement
          </text>
        </g>
      </g>
    </svg>
  </div>

  <h2>Action Selection</h2>

  <p>For each candidate action, we compute where it would take us and score by similarity to goal:</p>

  <div class="diagram-container">
    <svg width="600" height="300" viewBox="0 0 600 300">
      <text x="300" y="25" text-anchor="middle" font-size="16" font-weight="bold" fill="#1976d2">Selecting the Best Action</text>

      <g transform="translate(200, 170)">
        <!-- Current state -->
        <circle cx="0" cy="0" r="15" fill="#1976d2"/>
        <text x="0" y="4" text-anchor="middle" font-size="10" fill="white">C</text>

        <!-- Goal -->
        <circle cx="250" cy="-80" r="20" fill="#4caf50"/>
        <text x="250" y="-76" text-anchor="middle" font-size="10" fill="white">G</text>

        <!-- Action 1 (good) -->
        <line x1="15" y1="-5" x2="100" y2="-50" stroke="#4caf50" stroke-width="3"/>
        <circle cx="100" cy="-50" r="8" fill="#4caf50"/>
        <text x="60" y="-45" font-size="10" fill="#4caf50">Action₁</text>
        <text x="100" y="-65" font-size="9" fill="#4caf50">score: 0.85 ✓</text>

        <!-- Action 2 (medium) -->
        <line x1="15" y1="5" x2="90" y2="20" stroke="#ff9800" stroke-width="2"/>
        <circle cx="90" cy="20" r="6" fill="#ff9800"/>
        <text x="60" y="40" font-size="10" fill="#ff9800">Action₂</text>
        <text x="90" y="45" font-size="9" fill="#999">score: 0.45</text>

        <!-- Action 3 (bad) -->
        <line x1="-10" y1="10" x2="-60" y2="50" stroke="#e53935" stroke-width="2"/>
        <circle cx="-60" cy="50" r="6" fill="#e53935"/>
        <text x="-80" y="65" font-size="10" fill="#e53935">Action₃</text>
        <text x="-60" y="80" font-size="9" fill="#999">score: 0.20</text>

        <!-- Similarity arcs -->
        <path d="M 100,-50 Q 175,-65 250,-80" fill="none" stroke="#4caf50" stroke-width="1" stroke-dasharray="4,4"/>
      </g>

      <!-- Selection box -->
      <g transform="translate(450, 230)">
        <rect x="-80" y="-25" width="160" height="50" fill="#e8f5e9" stroke="#4caf50" rx="5"/>
        <text x="0" y="-5" text-anchor="middle" font-size="11" font-weight="bold" fill="#4caf50">Selected: Action₁</text>
        <text x="0" y="15" text-anchor="middle" font-size="10" fill="#666">Best similarity to goal</text>
      </g>
    </svg>
  </div>

  <h2>Handling Plateaus</h2>

  <p>When no action improves the score, we've hit a <strong>plateau</strong>. Spock provides multiple strategies:</p>

  <div class="strategy-card">
    <h4>Strategy: <code>fail</code> (Default)</h4>
    <p>Return immediately with partial results. Best when you need guarantees.</p>
    <div class="algorithm-box" style="padding: 12px">
<span class="keyword">return</span> { success: false, reason: 'plateau', steps };
    </div>
  </div>

  <div class="strategy-card">
    <h4>Strategy: <code>random_restart</code></h4>
    <p>Add random perturbation and continue. May escape local minima.</p>
    <div class="algorithm-box" style="padding: 12px">
current = <span class="function">normalise</span>(current + randomVector() * 0.1);
<span class="comment">// Continue from perturbed position</span>
    </div>
  </div>

  <div class="strategy-card">
    <h4>Strategy: <code>procedural_fallback</code></h4>
    <p>Invoke an external JavaScript solver for sub-problems.</p>
    <div class="algorithm-box" style="padding: 12px">
<span class="keyword">if</span> (context.proceduralSolver) {
    <span class="keyword">return</span> context.<span class="function">proceduralSolver</span>(current, goal, steps);
}
    </div>
  </div>

  <h2>The Solve Verb</h2>

  <p>While <code>Plan</code> finds a sequence of actions, <code>Solve</code> finds a point satisfying multiple constraints:</p>

  <div class="diagram-container">
    <svg width="500" height="280" viewBox="0 0 500 280">
      <text x="250" y="25" text-anchor="middle" font-size="16" font-weight="bold" fill="#1976d2">Constraint Satisfaction</text>

      <g transform="translate(250, 150)">
        <!-- Constraint regions (circles) -->
        <circle cx="-60" cy="-30" r="80" fill="none" stroke="#1976d2" stroke-width="2" stroke-dasharray="5,5"/>
        <text x="-60" y="-100" text-anchor="middle" font-size="11" fill="#1976d2">Constraint A</text>

        <circle cx="60" cy="-30" r="80" fill="none" stroke="#4caf50" stroke-width="2" stroke-dasharray="5,5"/>
        <text x="60" y="-100" text-anchor="middle" font-size="11" fill="#4caf50">Constraint B</text>

        <circle cx="0" cy="50" r="80" fill="none" stroke="#ff9800" stroke-width="2" stroke-dasharray="5,5"/>
        <text x="0" y="130" text-anchor="middle" font-size="11" fill="#ff9800">Constraint C</text>

        <!-- Intersection (solution region) -->
        <ellipse cx="0" cy="0" rx="25" ry="30" fill="#e8f5e9" stroke="#4caf50" stroke-width="2"/>
        <text x="0" y="5" text-anchor="middle" font-size="10" font-weight="bold" fill="#4caf50">Solution</text>

        <!-- Initial point -->
        <circle cx="-100" cy="60" r="8" fill="#e53935"/>
        <text x="-100" y="85" text-anchor="middle" font-size="10" fill="#e53935">Start</text>

        <!-- Path to solution -->
        <path d="M -95,55 Q -60,40 -30,20 T 0,0" fill="none" stroke="#9c27b0" stroke-width="2" marker-end="url(#solveArrow)"/>

        <defs>
          <marker id="solveArrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
            <polygon points="0 0, 8 3, 0 6" fill="#9c27b0"/>
          </marker>
        </defs>
      </g>

      <text x="250" y="265" text-anchor="middle" font-size="11" fill="#666">Solve iteratively projects onto each constraint until all are satisfied</text>
    </svg>
  </div>

  <div class="algorithm-box">
<span class="keyword">function</span> <span class="function">solve</span>(initial, constraints, options) {
    <span class="keyword">let</span> current = initial;

    <span class="keyword">while</span> (iterations < maxSteps) {
        <span class="keyword">let</span> anyViolation = false;

        <span class="keyword">for</span> (constraint <span class="keyword">of</span> constraints) {
            <span class="keyword">let</span> similarity = <span class="function">cosineSim</span>(current, constraint.vector);
            <span class="keyword">let</span> violation = constraint.minSimilarity - similarity;

            <span class="keyword">if</span> (violation > epsilon) {
                anyViolation = true;
                <span class="comment">// Project toward constraint</span>
                <span class="keyword">let</span> adjustment = <span class="function">scale</span>(constraint.vector, violation * 0.5);
                current = <span class="function">normalise</span>(current + adjustment);
            }
        }

        <span class="keyword">if</span> (!anyViolation) <span class="keyword">break</span>;  <span class="comment">// All satisfied!</span>
    }

    <span class="keyword">return</span> { solution: current, satisfied: !anyViolation };
}
  </div>

  <h2>Why Navigation Works</h2>

  <table class="matrix-table">
    <tr>
      <th>Property</th>
      <th>Benefit</th>
    </tr>
    <tr>
      <td><strong>Continuous</strong></td>
      <td>No discrete rule matching; smooth transitions</td>
    </tr>
    <tr>
      <td><strong>Greedy but informed</strong></td>
      <td>Gradient points to best local direction</td>
    </tr>
    <tr>
      <td><strong>Anytime</strong></td>
      <td>Can return partial results after any step</td>
    </tr>
    <tr>
      <td><strong>Traceable</strong></td>
      <td>Every step is a recorded action</td>
    </tr>
    <tr>
      <td><strong>Composable</strong></td>
      <td>Actions are vectors; can be learned or generated</td>
    </tr>
  </table>

  <h2>Trace Output</h2>

  <p>Every planning run produces a DSL trace that can be replayed:</p>

  <div class="algorithm-box">
<span class="comment"># Planning trace for: reach(Kitchen)</span>
@step0 StartState Identity _           <span class="comment"># Initial state</span>
@step1 step0 GoTo Hallway              <span class="comment"># action: GoTo, dist: 0.82→0.65</span>
@step2 step1 GoTo LivingRoom           <span class="comment"># action: GoTo, dist: 0.65→0.41</span>
@step3 step2 GoTo Kitchen              <span class="comment"># action: GoTo, dist: 0.41→0.08</span>
@result step3 Evaluate Goal            <span class="comment"># Final: 0.92 similarity</span>
  </div>

  <div class="footer-nav">
    <p>
      <a href="vsa-operations.html">← Vector Symbolic Operations</a> ·
      <strong>Next:</strong> <a href="theory-spaces.html">Theories as Subspaces →</a>
    </p>
  </div>
  </div>
</body>
</html>
